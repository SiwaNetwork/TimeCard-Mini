# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Quantum Mini-PCI Timecard

## üåê –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ Grafana

**URL:** http://90.156.231.174

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä Shiwa Network, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ TimeCard Mini. –î–∞–Ω–Ω—ã–µ –æ—Ç –≤–∞—à–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–≥—Ä—É–∂–∞—é—Ç—Å—è –Ω–∞ —ç—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä **–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É** –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏.

**–í—ã–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Shiwa Time.**

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –≤—ã–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

–î–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É
ssh shiwa@192.168.16.238

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nano /etc/shiwatime/shiwatime.yml

# –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ–∫—Ü–∏—é output.elasticsearch:
# output.elasticsearch:
#   hosts: ['90.156.231.174:9200']

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
sudo systemctl restart shiwatime
```

**–£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```
–ê–¥–º–∏–Ω:  admin / admin
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: user / user
```

**–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:** TESTER

---

## üìä –ß—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚è±Ô∏è **Offset** - –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥—ã)
- üìà **Jitter** - –≤–∞—Ä–∏–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–∏–≥–Ω–∞–ª–∞
- üìâ **Drift** - —Å–∫–æ—Ä–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–º–µ—â–µ–Ω–∏—è
- üîß **Frequency adjustment** - –∫–æ—Ä—Ä–µ–∫—Ü–∏—è —á–∞—Å—Ç–æ—Ç—ã —á–∞—Å–æ–≤

### PTP –º–µ—Ç—Ä–∏–∫–∏
- üì° Sync messages rate
- ‚è∞ Delay Request/Response
- üõ£Ô∏è Path delay
- ‚öôÔ∏è Clock quality (class, accuracy)

### GNSS –º–µ—Ç—Ä–∏–∫–∏
- üõ∞Ô∏è –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø—É—Ç–Ω–∏–∫–æ–≤
- üì∂ –ö–∞—á–µ—Å—Ç–≤–æ —Å–∏–≥–Ω–∞–ª–∞ (SNR)
- üìç –°—Ç–∞—Ç—É—Å —Ñ–∏–∫—Å–∞—Ü–∏–∏ (2D/3D fix)
- ‚è≤Ô∏è GNSS offset

### –°–µ—Ç–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- üì¶ Packet rate (PTP –ø–∞–∫–µ—Ç–æ–≤/—Å–µ–∫)
- üåê Network jitter
- üìä Unicast/Multicast —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

---

## ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞ | –û—Ç–ª–∏—á–Ω–æ | –•–æ—Ä–æ—à–æ | –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è |
|---------|---------|--------|------------------|
| **Offset** | ¬±50 ns | ¬±100 ns | >500 ns |
| **Jitter** | <10 ns | 10-50 ns | >100 ns |
| **GNSS —Å–ø—É—Ç–Ω–∏–∫–∏** | >8 | 4-8 | <4 |
| **PTP packet loss** | 0% | <1% | >1% |

---

## üîß –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ù–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ Timecard Mini

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:**
```bash
ssh shiwa@192.168.16.238
status
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**
```bash
logs
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –≤ Elasticsearch:**
```bash
sudo journalctl -u shiwatime -f | grep -E "elasticsearch|output"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞

**–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Elasticsearch:**
```bash
curl http://90.156.231.174:9200
```

**–ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ:**
```bash
curl -X GET "http://90.156.231.174:9200/shiwatime-*/_search?pretty" \
  -H 'Content-Type: application/json' -d'
{
  "query": { "match": { "name": "TESTER" } },
  "size": 5,
  "sort": [ { "@timestamp": { "order": "desc" } } ]
}'
```

---

## üö® –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –î–∞–Ω–Ω—ã–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ Grafana

**–ü—Ä–∏—á–∏–Ω—ã:**
1. ‚ùå Elasticsearch –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
2. ‚ùå Shiwatime –Ω–µ –∑–∞–ø—É—â–µ–Ω
3. ‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è output

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ù–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
ssh shiwa@192.168.16.238

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo grep -A 3 "output.elasticsearch" /etc/shiwatime/shiwatime.yml

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# output.elasticsearch:
#   hosts: ['90.156.231.174:9200']

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
status

# –ï—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω - –∑–∞–ø—É—Å—Ç–∏—Ç—å
restart

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
sudo journalctl -u shiwatime -n 50 | grep -i error
```

### –ë–æ–ª—å—à–æ–π offset (>500ns)

**–ü—Ä–∏—á–∏–Ω—ã:**
1. üõ∞Ô∏è –ü–ª–æ—Ö–æ–π GNSS —Å–∏–≥–Ω–∞–ª
2. üì° –ü—Ä–æ–±–ª–µ–º—ã —Å PPS
3. üåê –°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ GNSS –∞–Ω—Ç–µ–Ω–Ω—É (–≤–∏–¥ –Ω–∞ –Ω–µ–±–æ, –∫–∞–±–µ–ª—å –Ω–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø—É—Ç–Ω–∏–∫–æ–≤ –≤ Grafana (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å >4)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: `ping 90.156.231.174`
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å: `restart`

### –ü–æ—Ç–µ—Ä—è GNSS —Å–∏–≥–Ω–∞–ª–∞

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø—É—Ç–Ω–∏–∫–æ–≤ = 0
- GNSS offset = N/A
- Clock class –ø–µ—Ä–µ–∫–ª—é—á–∏–ª—Å—è –Ω–∞ >6

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–Ω—Ç–µ–Ω–Ω—É –∏ –∫–∞–±–µ–ª—å
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∞–Ω—Ç–µ–Ω–Ω–∞ –≤–∏–¥–∏—Ç –Ω–µ–±–æ (–Ω–µ—Ç –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∏—Ç–∞–Ω–∏–µ –∞–Ω—Ç–µ–Ω–Ω—ã (–µ—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–∞—è)
4. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ —Å–ø—É—Ç–Ω–∏–∫–æ–≤

---

## üì± –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –í Grafana (–µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Alerting** ‚Üí **Alert rules**
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ:
   - **Name:** High Offset Alert
   - **Condition:** `offset > 500ns` –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç
   - **Action:** –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –∫–∞–Ω–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–∞–Ω–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
   - Email
   - Telegram
   - Slack
   - Webhook

---

## üìñ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ [SHIWATIME_GUIDE.md](SHIWATIME_GUIDE.md) - —Ä–∞–∑–¥–µ–ª "–í–µ–±-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Grafana –∏ Elasticsearch"

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **Grafana:** http://90.156.231.174
- **Elasticsearch:** http://90.156.231.174:9200
- **–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:** ssh shiwa@192.168.16.238
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [SHIWATIME_GUIDE.md](SHIWATIME_GUIDE.md)

