# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã

## üìã –ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞

–≠—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Å–æ–∑–¥–∞–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ:
- ‚úÖ **62 –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–º–µ—â–µ–Ω–∏–π** —Å—Ç—Ä—É–∫—Ç—É—Ä—ã UBXTP5Message
- ‚úÖ **–ì—Ä–∞—Ñ–∞ –≤—ã–∑–æ–≤–æ–≤** servo —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã** clocksync –º–æ–¥—É–ª–µ–π
- ‚úÖ **COMPLETE_ANALYSIS_REPORT.md**

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É

–§–∞–π–ª `program_structure.go` —Å–æ–¥–µ—Ä–∂–∏—Ç:
- ‚úÖ –ü–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É UBXTP5Message —Å –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ —Å–º–µ—â–µ–Ω–∏—è–º–∏
- ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—é ToBytes() –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ú–µ—Ç–æ–¥—ã SetPulseWidth() –∏ GetPulseWidth()
- ‚úÖ Servo —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥—Ä–∞—Ñ–∞ –≤—ã–∑–æ–≤–æ–≤
- ‚úÖ HostClock —Å—Ç—Ä—É–∫—Ç—É—Ä—É

### 2. –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

#### UBXTP5Message

```go
// Pulse width –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ offset 16
msg := &UBXTP5Message{}
msg.SetPulseWidth(5000000) // 5 –º—Å –≤ –Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥–∞—Ö
```

#### Servo —Ñ—É–Ω–∫—Ü–∏–∏

```go
// –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
now, err := GetClockUsingGetTimeSyscall()

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–∏
err := StepClockUsingSetTimeSyscall(newTime)

// –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç–∏
granularity, err := PerformGranularityMeasurement()
```

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å

### 1. –†–µ–∞–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `time.Now()` –∫–∞–∫ –∑–∞–≥–ª—É—à–∫—É. –ù—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞:

```go
import "golang.org/x/sys/unix"

func GetClockUsingGetTimeSyscall() (time.Time, error) {
    var ts unix.Timespec
    err := unix.ClockGettime(unix.CLOCK_REALTIME, &ts)
    if err != nil {
        return time.Time{}, err
    }
    return time.Unix(ts.Sec, ts.Nsec), nil
}
```

### 2. Serial port –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è

–î–æ–±–∞–≤—å—Ç–µ —Ä–µ–∞–ª—å–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É UBX –∫–æ–º–∞–Ω–¥:

```go
import "github.com/tarm/serial"

func (d *UBXDevice) sendUBXCommand(data []byte) error {
    c := &serial.Config{Name: d.port, Baud: d.baud}
    s, err := serial.OpenPort(c)
    if err != nil {
        return err
    }
    defer s.Close()
    
    _, err = s.Write(data)
    return err
}
```

### 3. –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ UBXTP5Message

–°–µ–π—á–∞—Å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è (offset 0-32). –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ 56 –ø–æ–ª–µ–π –ø–æ –Ω–∞–π–¥–µ–Ω–Ω—ã–º —Å–º–µ—â–µ–Ω–∏—è–º –∏–∑ `algorithm_details.txt`.

### 4. Servo –∞–ª–≥–æ—Ä–∏—Ç–º—ã

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è - –±–∞–∑–æ–≤–∞—è. –î–ª—è –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ:
- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã `analyze_servo_algorithms.py`
- –ò–∑–≤–ª–µ—á—å PID –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º—ã –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏

## üìä –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Å–º–µ—â–µ–Ω–∏—è

–ò–∑ `algorithm_details.txt` –Ω–∞–π–¥–µ–Ω–æ 62 —Å–º–µ—â–µ–Ω–∏—è:

| Offset | Read | Write | –ü—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ |
|--------|------|-------|---------------|
| 8 | 16 | 17 | FreqPeriod |
| 16 | 37 | 17 | **PulseLenRatio** ‚≠ê |
| 24 | 6 | 8 | UserConfigDelay |
| 32 | 15 | 6 | Flags |
| ... | ... | ... | ... |

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤ `algorithm_details.txt`.

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `program_structure.go` –∫–∞–∫ –æ—Å–Ω–æ–≤—É
2. ‚ö†Ô∏è –î–æ–±–∞–≤—å—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã
3. ‚ö†Ô∏è –†–µ–∞–ª–∏–∑—É–π—Ç–µ serial port –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é
4. ‚ö†Ô∏è –î–æ–±–∞–≤—å—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è UBXTP5Message
5. ‚ö†Ô∏è –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ servo –∞–ª–≥–æ—Ä–∏—Ç–º—ã (–∑–∞–ø—É—Å—Ç–∏—Ç–µ `find_servo_by_names.py`)

## üìù –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```go
package main

import (
    "fmt"
    "log"
)

func main() {
    // –°–æ–∑–¥–∞–Ω–∏–µ UBX —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    device := NewUBXDevice("/dev/ttyS0", 9600)
    
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è timepulse –Ω–∞ 5 –º—Å
    err := device.ConfigureTimePulse(5000000)
    if err != nil {
        log.Fatal(err)
    }
    
    // –†–∞–±–æ—Ç–∞ —Å —á–∞—Å–∞–º–∏
    clock := &HostClock{}
    now, err := clock.GetTimeNow()
    if err != nil {
        log.Fatal(err)
    }
    fmt.Printf("–í—Ä–µ–º—è: %v\n", now)
}
```

---

*–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞–∫ –æ—Å–Ω–æ–≤—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã!*
