# ‚úÖ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

## üéØ –ß—Ç–æ –Ω–∞–π–¥–µ–Ω–æ

### 1. CoefficientStore ‚≠ê‚≠ê‚≠ê

**–§—É–Ω–∫—Ü–∏–∏:**
- `GetCoefficientStore` (0x41c6270)
- `newCoefficientStore` (0x41c60f0)
- `GetCoefficients` (0x41c6520)
- `GetCoefficientsForType` (0x41c62d0)
- `ChangeSteeringCoefficients` (0x41c6840)
- `updateAlgoCoefficients` (0x41daf30)

**–î–∞–Ω–Ω—ã–µ:**
- `DefaultAlgoCoefficients` (0x770b7e0) ‚≠ê - **–î–ï–§–û–õ–¢–ù–´–ï –ö–û–≠–§–§–ò–¶–ò–ï–ù–¢–´!**

---

### 2. PID –∞–ª–≥–æ—Ä–∏—Ç–º ‚≠ê‚≠ê‚≠ê

#### CalculateNewFrequency (0x41c87c0)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ AlgoPID:**
- `[x0, #24]` - –∏–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω–∞—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (I)
- `[x0, #40]` - —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
- `[x0, #48]` - —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ BestFitFiltered
- `[x0, #96]` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏
- `[x0, #112]` - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏
- `[x0, #128]` - —Ñ–ª–∞–≥ –æ—Ç–ª–∞–¥–∫–∏

**–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã (–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–æ [x0, #40]):**
- `[x2, #0]` - –ø–µ—Ä–≤—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (Kp?)
- `[x2, #8]` - –≤—Ç–æ—Ä–æ–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (Ki?)
- `[x2, #16]` - —Ç—Ä–µ—Ç–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (Kd?)

**–ú–∞—Å—Å–∏–≤ D-–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤:**
- –ê–¥—Ä–µ—Å: **0x770a430**
- –†–∞–∑–º–µ—Ä: **3 —ç–ª–µ–º–µ–Ω—Ç–∞** (float64, 24 –±–∞–π—Ç–∞)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –≤—ã–±–æ—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É –æ—Ç `log(abs(value))`
- –ò–Ω–¥–µ–∫—Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω: 0-2

**–§–æ—Ä–º—É–ª–∞ PID (–∏–∑ –∞—Å—Å–µ–º–±–ª–µ—Ä–∞):**
```go
P = Kp * offset
I = Ki * offset + previous_I
D = D_coefficients[log_index] * gradient / divisor
frequency = P + I + D
```

**enforceAdjustmentLimit (0x41c8cc0):**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç—ã: `[x0, #96]` (max), `[x0, #112]` (min)
- –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –ª–∏–º–∏—Ç: `[x0, #40]` -> `[x3, #32]`

---

### 3. PI –∞–ª–≥–æ—Ä–∏—Ç–º ‚≠ê‚≠ê

#### pi_sample (0x41c8da0)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ pi_servo:**
- `[x0, #56]` - –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –≤—Ä–µ–º—è
- `[x0, #64]` - —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
- `[x0, #72]` - –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–º–µ—â–µ–Ω–∏–µ
- `[x0, #80]` - —Ç–µ–∫—É—â–µ–µ —Å–º–µ—â–µ–Ω–∏–µ
- `[x0, #88]` - –∏–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω–∞—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (I)
- `[x0, #104]` - –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
- `[x0, #112]` - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- `[x0, #120]` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ (0, 1, –∏–ª–∏ –¥—Ä—É–≥–æ–µ)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
- –î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- –†–∞—Å—á–µ—Ç I –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: `I = prev_I + (51712 - prev_I) * offset_diff / time_diff`
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ I: `-max_value <= I <= max_value`

**–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã:**
- `0xa59836b45f418970` - –º–∞–≥–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞
- `0xca00` (51712) - –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ I
- `0x3b9a` (15258) - —á–∞—Å—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

---

### 4. LinReg –∞–ª–≥–æ—Ä–∏—Ç–º ‚≠ê‚≠ê‚≠ê

#### regress (0x41c6e30)

**–†–∞–∑–º–µ—Ä –æ–∫–Ω–∞:** ‚úÖ **64 —ç–ª–µ–º–µ–Ω—Ç–∞** (0x40)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ linreg_servo:**
- `0x638` (1592) - –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö (64 —ç–ª–µ–º–µ–Ω—Ç–∞)
- `0x1536` (5430) - —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–µ –≤—Ä–µ–º—è
- `0x1544` (5444) - —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ
- `0x1560` (5472) - —Å—á–µ—Ç—á–∏–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- `0x1568` (5480) - –∏–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
- `0x1584` (5508) - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å—á–µ—Ç—á–∏–∫
- `0x1752` (5970) - —Ä–∞–∑–º–µ—Ä –æ–∫–Ω–∞
- `0x1760` (5984) - —á–∞—Å—Ç–æ—Ç–∞ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏
- `0x1768` (5992) - –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `0x1776` (6006) - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —á–∞—Å—Ç–æ—Ç—ã
- `0x1784` (6020) - —Ñ–ª–∞–≥ leap
- `0x1792` (6034) - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- `0x1800` (6144) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- `0x1808` (6152) - –ø–æ—Ä–æ–≥ –¥–ª—è leap
- `0x1816` (6166) - —Ñ–ª–∞–≥ –¥–ª—è leap

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
- –õ–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è –ø–æ 5 –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º (2, 3, 4, 5, 6)
- –§–æ—Ä–º—É–ª–∞: `slope = (Œ£xy - Œ£x¬∑Œ£y/n) / (Œ£x¬≤ - (Œ£x)¬≤/n)`
- `intercept = (Œ£y - slope¬∑Œ£x) / n`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã: 2, 3, 4, 5, 6 (5 –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤)
- –ü–æ—Ä–æ–≥ —É—Å—Ä–µ–¥–Ω–µ–Ω–∏—è: 10 (0xa)
- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–∑ –ø–∞–º—è—Ç–∏ (504b000): offset 416, 872, 1632

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –Ω–∞—Ö–æ–¥–æ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–π–¥–µ–Ω–æ | –°—Ç–∞—Ç—É—Å |
|-----------|---------|--------|
| **CoefficientStore** | ‚úÖ –§—É–Ω–∫—Ü–∏–∏ + –¥–∞–Ω–Ω—ã–µ | ‚úÖ |
| **PID —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** | ‚úÖ –°–º–µ—â–µ–Ω–∏—è | ‚úÖ |
| **PID –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã** | ‚ö†Ô∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞–π–¥–µ–Ω–∞, –∑–Ω–∞—á–µ–Ω–∏—è –Ω—É–∂–Ω–æ –∏–∑–≤–ª–µ—á—å | ‚ö†Ô∏è |
| **PID D-–º–∞—Å—Å–∏–≤** | ‚úÖ –ê–¥—Ä–µ—Å 0x770a430 | ‚úÖ |
| **PI —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** | ‚úÖ –°–º–µ—â–µ–Ω–∏—è | ‚úÖ |
| **PI –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã** | ‚ö†Ô∏è –ù—É–∂–Ω–æ –∏–∑–≤–ª–µ—á—å | ‚ö†Ô∏è |
| **LinReg —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** | ‚úÖ –í—Å–µ —Å–º–µ—â–µ–Ω–∏—è | ‚úÖ |
| **LinReg –æ–∫–Ω–æ** | ‚úÖ 64 —ç–ª–µ–º–µ–Ω—Ç–∞ | ‚úÖ |
| **LinReg –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** | ‚úÖ –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã, –ø–æ—Ä–æ–≥–∏ | ‚úÖ |

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –ò–∑–≤–ª–µ—á—å –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç
python3 extract_coefficients.py

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
objdump -s -j .data /usr/share/shiwatime/bin/shiwatime | grep -A 10 "770b7e0"
objdump -s -j .data /usr/share/shiwatime/bin/shiwatime | grep -A 3 "770a430"
```

### 2. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å GetCoefficients

```bash
objdump -d /usr/share/shiwatime/bin/shiwatime | grep -A 50 "41c6520"
```

### 3. –ò–∑–≤–ª–µ—á—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–∑ –ø–∞–º—è—Ç–∏

```bash
objdump -s /usr/share/shiwatime/bin/shiwatime | grep -A 5 "504b000"
```

---

## üìà –ü—Ä–æ–≥—Ä–µ—Å—Å

**–≠—Ç–∞–ø 1: 85% ‚Üí 88%** ‚úÖ

- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä—ã –Ω–∞–π–¥–µ–Ω—ã
- ‚úÖ –°–º–µ—â–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- ‚úÖ –ê–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–Ω—è—Ç–Ω—ã
- ‚ö†Ô∏è –ó–Ω–∞—á–µ–Ω–∏—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ - –Ω—É–∂–Ω–æ –∏–∑–≤–ª–µ—á—å –∏–∑ –ø–∞–º—è—Ç–∏

**–û—Å—Ç–∞–ª–æ—Å—å:** –ò–∑–≤–ª–µ—á—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –∞–¥—Ä–µ—Å–æ–≤ 0x770b7e0 –∏ 0x770a430

---

*–û—Ç–ª–∏—á–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å! –°—Ç—Ä—É–∫—Ç—É—Ä—ã –Ω–∞–π–¥–µ–Ω—ã, –æ—Å—Ç–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å –∑–Ω–∞—á–µ–Ω–∏—è!*
